---
title: "Final Project\nAugust Decz\nSTAT 408\nDr. Stuart "
format: 
  html:
    self-contained: true
    embed-resources: true
editor: visual
execute: 
  echo: true
  include: true
---

### Introduction

FIFA 23 is a soccer video game previously owned by Electronic Arts (EA), also known for famous titles such as Madden, NCAA, the Sims, and many more. I personally have been playing FIFA since 2012 when I was a kid, and have grown a strong affinity for its playstyle and frequent updates mimicking the current state of the soccer world. Each player in the game is created with many factors (other than graphical and animations) that determine their overall rating (e.g. Messi is a 90 overall but has 87 speed, 94 dribbling etc.), and how those ratings actually transfer to in game play usually determines market value. The FIFA market is a (mostly) completely open laissez-faire market where supply and demand run the show. Higher rated players (or more known players like Messi/Ronaldo) are worth more coins than lower rated players. For this project, I will analyze/determine how specific attributes that go into a player\'s FIFA card rating determine market value. Note that since the game is from over two years ago EA closes the open market down and final market values are unchangeable. 

The dataset I found uses only base cards from the version of the game from 2023, I was unable to find a more recent dataset that has the proper columns to answer the questions I strive to answer. Using only base cards eliminates the factor of limited availability (as promo or special cards are harder to find or may have only been available for a select amount of time e.g. Team of the Year cards). The full dataset consists of 16710 observations (each observation is a base player card) and 65 variables describing the player including nationality, height, etc. Note that not all attributes for a player are included in determining the rating, typically statistics such as pace(speed), shooting, passing, dribbling, defense, and physicality are averaged to find a player\'s rating. However, having played FIFA for a long time I know that taller players are typically valued more (and other examples) so I will be including many different variables in my model to predict player market value. Our ultimate goal is to determine what player attributes best predict FIFA market value.

1.  Loading in the dataset

```{r}
library(tidyverse)
fifa <- read.csv('FIFA22_official_data.csv')
head(fifa)
names(fifa)
```

```{r}
# CLEAN DATA
fifa_clean <- fifa %>% 
  dplyr::select(Value, Age, Overall, Preferred.Foot, Skill.Moves, Height, Weight,
         Crossing, Finishing, HeadingAccuracy, ShortPassing, Volleys,
         Dribbling, Curve, FKAccuracy, LongPassing, BallControl,
         Acceleration, SprintSpeed, Agility, Reactions, Balance,
         ShotPower, Jumping, Stamina, Strength, LongShots, Aggression,
         Interceptions, Positioning, Vision, Penalties, Composure,
         StandingTackle, SlidingTackle, DefensiveAwareness) %>% 
  # converting value strings to numerics and removing unit symbols (note: still in euros... virtual money so does not really matter)
  mutate(
    Value = gsub("€", "", Value),
    Value = case_when(
      grepl("M", Value) ~ as.numeric(gsub("M", "", Value)) * 1e6,
      grepl("K", Value) ~ as.numeric(gsub("K", "", Value)) * 1e3,
      TRUE ~ as.numeric(Value)
    ),
    Height = as.numeric(gsub("cm", "", Height)),
    Weight = as.numeric(gsub("kg", "", Weight))
  ) %>%
  filter(is.finite(Value), Value > 0) %>% 
  na.omit()
```

Summary Stats and Visual Exploration

```{r}
summary(fifa_clean)
skimr::skim(fifa_clean)
```

now lets see if it runs the model

```{r}
mod_initial <- lm(Value ~ ., fifa_clean)
summary(mod_initial)
plot(mod_initial,1)
plot(mod_initial,2)
```

Extreme heteroscedasticity and normality clearly violated.

lets try a box cox to see what kind of transformation we should do.

$\lambda \approx -0.067$ SIX SEVEN (Imagine me doing the hand motion here)

```{r}
library(MASS)
bc <- boxcox(mod_initial)
lambda <- bc$x[which.max(bc$y)]
lambda
```

```{r}
# log transformation
fifa_clean <- fifa_clean %>%
  mutate(Value_bc = log(Value))
```

refitting

```{r}
mod_bc <- lm(Value_bc ~ ., data = fifa_clean %>% dplyr::select(-Value))
summary(mod_bc)

# Diagnostic plots
plot(mod_bc, 1)
plot(mod_bc, 2)
summary(mod_bc)
```

we have chosen mod_bc (log transformation as our model) bc the adjusted rsquared is much better now

```{r}
diff_norm_log <- summary(mod_bc)$adj.r.squared - summary(mod_initial)$adj.r.squared
diff_norm_log * 100
```

```{r}
library(car)
vif(mod_bc)
```

stepwise model because we have multicollinearity

```{r}
step_mod <- step(mod_bc, method = 'backwards')
```

maybe include these interaction terms

-   **Acceleration × SprintSpeed** (pace synergy)

-   **Strength × Aggression** (physicality combo)

-   **SkillMoves × Dribbling** (skill amplifies dribbling)

-   **Height × Jumping** (aerial ability interaction)
