TRUE ~ as.numeric(Value)
),
Height = as.numeric(gsub("cm", "", Height)),
Weight = as.numeric(gsub("kg", "", Weight))
) %>%
# ---- Remove problematic rows ----
filter(is.finite(Value), Value > 0) %>%
na.omit()
mod <- lm(Value ~ ., fifa_clean)
summary(mod)
plot(mod)
mod <- lm(Value ~ ., fifa_clean)
summary(mod)
plot(mod,1)
plot(mod,2)
mod_initial <- lm(Value ~ ., fifa_clean)
summary(mod_initial)
plot(mod_initial,1)
plot(mod_inital,2)
mod_initial <- lm(Value ~ ., fifa_clean)
summary(mod_initial)
plot(mod_initial,1)
plot(mod_initial,2)
library(tidyverse)
library(MASS)
fifa <- read.csv('FIFA22_official_data.csv')
head(fifa)
# --- CLEAN DATA ---
fifa_clean <- fifa %>%
select(Value, Age, Overall, Preferred.Foot, Skill.Moves, Height, Weight,
Crossing, Finishing, HeadingAccuracy, ShortPassing, Volleys,
Dribbling, Curve, FKAccuracy, LongPassing, BallControl,
Acceleration, SprintSpeed, Agility, Reactions, Balance,
ShotPower, Jumping, Stamina, Strength, LongShots, Aggression,
Interceptions, Positioning, Vision, Penalties, Composure,
StandingTackle, SlidingTackle, DefensiveAwareness) %>%
# ---- Convert Value strings ("€100M", "€80K") to numeric ----
mutate(
Value = gsub("€", "", Value),
Value = case_when(
grepl("M", Value) ~ as.numeric(gsub("M", "", Value)) * 1e6,
grepl("K", Value) ~ as.numeric(gsub("K", "", Value)) * 1e3,
TRUE ~ as.numeric(Value)
),
Height = as.numeric(gsub("cm", "", Height)),
Weight = as.numeric(gsub("kg", "", Weight))
) %>%
# ---- Remove problematic rows ----
filter(is.finite(Value), Value > 0) %>%
na.omit()
mod_initial <- lm(Value ~ ., fifa_clean)
summary(mod_initial)
plot(mod_initial,1)
plot(mod_initial,2)
library(MASS)
bc <- boxcox(mod_initial)
lambda <- bc$x[which.max(bc$y)]
lambda
# log transformation
fifa_clean <- fifa_clean %>%
mutate(Value_bc = log(Value))
mod_bc <- lm(Value_bc ~ ., data = fifa_clean %>% select(-Value))
summary(mod_bc)
# Diagnostic plots
par(mfrow = c(2,2))
plot(mod_bc)
mod_bc <- lm(Value_bc ~ ., data = fifa_clean %>% select(-Value))
summary(mod_bc)
# Diagnostic plots
plot(mod_bc, 1)
ploy(mod_bc, 2)
mod_bc <- lm(Value_bc ~ ., data = fifa_clean %>% select(-Value))
summary(mod_bc)
# Diagnostic plots
plot(mod_bc, 1)
plot(mod_bc, 2)
source("~/.active-rstudio-document", echo = TRUE)
res <- abs(residuals(mod_bc))
res <- abs(residuals(mod_bc))
w <- 1 / (res^2)
res <- abs(residuals(mod_bc))
w <- 1 / (res^2)
mod_wls <- lm(Value_bc ~ .,
data = fifa_clean %>% select(-Value),
weights = w)
res <- abs(residuals(mod_bc))
w <- 1 / (res^2)
mod_wls <- lm(Value_bc ~ .,
data = fifa_clean %>% select(-Value),
weights = w)
plot(mod_wls, 1)
plot(mod_wls, 2)
res <- abs(residuals(mod_bc))
w <- res^2
mod_wls <- lm(Value_bc ~ .,
data = fifa_clean %>% select(-Value),
weights = w)
plot(mod_wls, 1)
plot(mod_wls, 2)
res <- abs(residuals(mod_bc))
w <- 1/ res^2
mod_wls <- lm(Value_bc ~ .,
data = fifa_clean %>% select(-Value),
weights = w)
plot(mod_wls, 1)
plot(mod_wls, 2)
resid = abs(residuals(mod_init))
resid = abs(residuals(mod_initial))
resid <- abs(residuals(mod_initial))
weights <- resid^2
mod_2 <- lm(Value ~ ., fifa_clean, weights = weights)
plot(mod_2,1)
plot(mod_2,2)
resid <- abs(residuals(mod_initial))
weights <- 1/ resid^2
mod_2 <- lm(Value ~ ., fifa_clean, weights = weights)
plot(mod_2,1)
plot(mod_2,2)
res <- abs(residuals(mod_bc))
w <- res^2
mod_wls <- lm(Value_bc ~ .,
data = fifa_clean %>% select(-Value),
weights = w)
plot(mod_wls, 1)
plot(mod_wls, 2)
library(nlme)
mod_gls <- gls(Value_bc ~ .,
data = fifa_clean,
weights = varPower())
plot(mod_gls,1)
library(nlme)
mod_gls <- gls(Value_bc ~ .,
data = fifa_clean,
weights = varPower())
plot(mod_gls)
res <- abs(residuals(mod_bc))
w <- res^2
mod_wls <- lm(Value_bc ~ .,
data = fifa_clean %>% select(-Value),
weights = w)
plot(mod_wls, 1)
plot(mod_wls, 2)
summary(mod_wls)
res <- abs(residuals(mod_bc))
w <- res^2
mod_wls <- lm(Value_bc ~ .,
data = fifa_clean %>% select(-Value),
weights = w)
plot(mod_wls, 1)
plot(mod_wls, 2)
summary(mod_wls)
anova(mod_bc, mod_wls)
summary(fifa_clean)
skimr::skim(fifa_clean)
library(tidyverse)
fifa <- read.csv('FIFA22_official_data.csv')
head(fifa)
names(fifa)
# CLEAN DATA
fifa_clean <- fifa %>%
dplyr::select(Value, Age, Overall, Preferred.Foot, Skill.Moves, Height, Weight,
Crossing, Finishing, HeadingAccuracy, ShortPassing, Volleys,
Dribbling, Curve, FKAccuracy, LongPassing, BallControl,
Acceleration, SprintSpeed, Agility, Reactions, Balance,
ShotPower, Jumping, Stamina, Strength, LongShots, Aggression,
Interceptions, Positioning, Vision, Penalties, Composure,
StandingTackle, SlidingTackle, DefensiveAwareness) %>%
# converting value strings to numerics and removing unit symbols (note: still in euros... virtual money so does not really matter)
mutate(
Value = gsub("€", "", Value),
Value = case_when(
grepl("M", Value) ~ as.numeric(gsub("M", "", Value)) * 1e6,
grepl("K", Value) ~ as.numeric(gsub("K", "", Value)) * 1e3,
TRUE ~ as.numeric(Value)
),
Height = as.numeric(gsub("cm", "", Height)),
Weight = as.numeric(gsub("kg", "", Weight))
) %>%
filter(is.finite(Value), Value > 0) %>%
na.omit()
summary(fifa_clean)
skimr::skim(fifa_clean)
mod_initial <- lm(Value ~ ., fifa_clean)
summary(mod_initial)
plot(mod_initial,1)
plot(mod_initial,2)
library(MASS)
bc <- boxcox(mod_initial)
lambda <- bc$x[which.max(bc$y)]
lambda
# log transformation
fifa_clean <- fifa_clean %>%
mutate(Value_bc = log(Value))
mod_bc <- lm(Value_bc ~ ., data = fifa_clean %>% dplyr::select(-Value))
summary(mod_bc)
# Diagnostic plots
plot(mod_bc, 1)
plot(mod_bc, 2)
summary(mod_bc)
diff_norm_log <- summary(mod_bc)$adj.r.squared - summary(mod_initial)$adj.r.squared
diff_norm_log * 100
library(car)
vif(mod_bc)
step_mod <- step(mod_bc, method = 'backwards')
step_mod <- step(mod_bc, method = 'backwards', trace = 0)
summary(step_mod)
vif(step_mod)
step_mod <- step(mod_bc, method = 'both', trace = 0)
summary(step_mod)
vif(step_mod)
View(fifa)
ggplot(fifa_clean, aes(x = Value))+
geom_bar()
value_bins <- fifa_clean %>%
select(value) %>%
ggplot(fifa_clean, aes(x = Value))+
geom_bar()
value_bins <- fifa_clean %>%
select(value) %>%
ggplot(fifa_clean, aes(x = Value_bc)) +
geom_histogram(bins = 50, fill = "darkgreen") +
labs(title = "Distribution of Log Market Value",
x = "log(Value)", y = "Count")
ggplot(fifa_clean, aes(x = Value_bc)) +
geom_histogram(bins = 50, fill = "darkgreen") +
labs(title = "Distribution of Log Market Value",
x = "log(Value)", y = "Count")
ggplot(fifa_clean, aes(x = Value)) +
geom_histogram(bins = 50, fill = "steelblue") +
scale_x_continuous(labels = scales::comma) +
labs(title = "Distribution of Player Market Value (Raw)",
x = "Market Value (€)", y = "Count")
ggplot(fifa_clean, aes(x = Value_bc)) +
geom_histogram(bins = 50, fill = "darkgreen") +
labs(title = "Distribution of Log Market Value",
x = "log(Value)", y = "Count")
ggplot(fifa_clean, aes(x = Value)) +
geom_histogram(bins = 50, fill = "steelblue") +
scale_x_continuous(labels = scales::comma) +
labs(title = "Distribution of Player Market Value (Raw)",
x = "Market Value (€)", y = "Count")
ggplot(fifa_clean, aes(x = Value_bc)) +
geom_histogram(bins = 50, fill = "darkgreen") +
labs(title = "Distribution of Log Market Value",
x = "log(Value)", y = "Count")
summary(fifa_clean))
summary(fifa_clean)
summary(fifa_clean$Value)
summary(fifa_clean$Value_bc)
summary(fifa_clean$Value)
library(MASS)
bc <- boxcox(mod_initial)
lambda <- bc$x[which.max(bc$y)]
lambda
library(tidyverse)
fifa <- read.csv('FIFA22_official_data.csv')
head(fifa)
names(fifa)
# CLEAN DATA
fifa_clean <- fifa %>%
dplyr::select(Value, Age, Overall, Preferred.Foot, Skill.Moves, Height, Weight,
Crossing, Finishing, HeadingAccuracy, ShortPassing, Volleys,
Dribbling, Curve, FKAccuracy, LongPassing, BallControl,
Acceleration, SprintSpeed, Agility, Reactions, Balance,
ShotPower, Jumping, Stamina, Strength, LongShots, Aggression,
Interceptions, Positioning, Vision, Penalties, Composure,
StandingTackle, SlidingTackle, DefensiveAwareness) %>%
# converting value strings to numerics and removing unit symbols (note: still in euros... virtual money so does not really matter)
mutate(
Value = gsub("€", "", Value),
Value = case_when(
grepl("M", Value) ~ as.numeric(gsub("M", "", Value)) * 1e6,
grepl("K", Value) ~ as.numeric(gsub("K", "", Value)) * 1e3,
TRUE ~ as.numeric(Value)
),
Height = as.numeric(gsub("cm", "", Height)),
Weight = as.numeric(gsub("kg", "", Weight))
) %>%
filter(is.finite(Value), Value > 0) %>%
na.omit()
summary(fifa_clean$Value)
ggplot(fifa_clean, aes(x = Value)) +
geom_histogram(bins = 50, fill = "steelblue") +
scale_x_continuous(labels = scales::comma) +
labs(title = "Distribution of Player Market Value (Raw)",
x = "Market Value (€)", y = "Count")
ggplot(fifa_clean, aes(x = Value_bc)) +
geom_histogram(bins = 50, fill = "darkgreen") +
labs(title = "Distribution of Log Market Value",
x = "log(Value)", y = "Count")
mod_bc <- lm(Value_bc ~ ., data = fifa_clean %>% dplyr::select(-Value))
# log transformation
fifa_clean <- fifa_clean %>%
mutate(Value_bc = log(Value))
mod_bc <- lm(Value_bc ~ ., data = fifa_clean %>% dplyr::select(-Value))
summary(mod_bc)
# Diagnostic plots
plot(mod_bc, 1)
plot(mod_bc, 2)
summary(mod_bc)
library(MASS)
bc <- boxcox(mod_initial)
lambda <- bc$x[which.max(bc$y)]
lambda
mod_initial <- lm(Value ~ ., fifa_clean)
summary(mod_initial)
plot(mod_initial,1)
plot(mod_initial,2)
ggplot(fifa_clean, aes(x = Value)) +
geom_histogram(bins = 50, fill = "steelblue") +
scale_x_continuous(labels = scales::comma) +
labs(title = "Distribution of Player Market Value (Raw)",
x = "Market Value (€)", y = "Count")
ggplot(fifa_clean, aes(x = Value_bc)) +
geom_histogram(bins = 50, fill = "darkgreen") +
labs(title = "Distribution of Log Market Value",
x = "log(Value)", y = "Count")
confint(step_mod)
library(tidyverse)
fifa <- read.csv('FIFA22_official_data.csv')
head(fifa)
names(fifa)
# CLEAN DATA
fifa_clean <- fifa %>%
dplyr::select(Value, Age, Overall, Preferred.Foot, Skill.Moves, Height, Weight,
Crossing, Finishing, HeadingAccuracy, ShortPassing, Volleys,
Dribbling, Curve, FKAccuracy, LongPassing, BallControl,
Acceleration, SprintSpeed, Agility, Reactions, Balance,
ShotPower, Jumping, Stamina, Strength, LongShots, Aggression,
Interceptions, Positioning, Vision, Penalties, Composure,
StandingTackle, SlidingTackle, DefensiveAwareness) %>%
# converting value strings to numerics and removing unit symbols (note: still in euros... virtual money so does not really matter)
mutate(
Value = gsub("€", "", Value),
Value = case_when(
grepl("M", Value) ~ as.numeric(gsub("M", "", Value)) * 1e6,
grepl("K", Value) ~ as.numeric(gsub("K", "", Value)) * 1e3,
TRUE ~ as.numeric(Value)
),
Height = as.numeric(gsub("cm", "", Height)),
Weight = as.numeric(gsub("kg", "", Weight))
) %>%
filter(is.finite(Value), Value > 0) %>%
na.omit()
summary(fifa_clean$Value)
mod_initial <- lm(Value ~ ., fifa_clean)
summary(mod_initial)
plot(mod_initial,1)
plot(mod_initial,2)
library(MASS)
bc <- boxcox(mod_initial)
lambda <- bc$x[which.max(bc$y)]
lambda
# log transformation
fifa_clean <- fifa_clean %>%
mutate(Value_bc = log(Value))
mod_bc <- lm(Value_bc ~ ., data = fifa_clean %>% dplyr::select(-Value))
summary(mod_bc)
# Diagnostic plots
plot(mod_bc, 1)
plot(mod_bc, 2)
summary(mod_bc)
diff_norm_log <- summary(mod_bc)$adj.r.squared - summary(mod_initial)$adj.r.squared
diff_norm_log * 100
library(car)
vif(mod_bc)
step_mod <- step(mod_bc, method = 'both', trace = 0)
summary(step_mod)
mod_bc <- lm(Value_bc ~ ., data = fifa_clean %>% dplyr::select(-Value))
# Diagnostic plots
plot(mod_bc, 1)
plot(mod_bc, 2)
summary(mod_bc)
confint(step_mod)
summary(fifa_clean$Value)
stdev(fifa_clean$Value)
summary(fifa_clean$Value)
std(fifa_clean$Value)
summary(fifa_clean$Value)
mean(fifa_clean$Value)
summary(fifa_clean$Value)
dev(fifa_clean$Value)
summary(fifa_clean$Value)
var(fifa_clean$Value)
summary(fifa_clean$Value)
var(fifa_clean$Value)^2
summary(fifa_clean$Value)
var(fifa_clean$Value)
library(tidyverse)
fifa <- read.csv('FIFA22_official_data.csv')
head(fifa)
names(fifa)
# CLEAN DATA
fifa_clean <- fifa %>%
dplyr::select(Value, Age, Overall, Preferred.Foot, Skill.Moves, Height, Weight,
Crossing, Finishing, HeadingAccuracy, ShortPassing, Volleys,
Dribbling, Curve, FKAccuracy, LongPassing, BallControl,
Acceleration, SprintSpeed, Agility, Reactions, Balance,
ShotPower, Jumping, Stamina, Strength, LongShots, Aggression,
Interceptions, Positioning, Vision, Penalties, Composure,
StandingTackle, SlidingTackle, DefensiveAwareness) %>%
# converting value strings to numerics and removing unit symbols (note: still in euros... virtual money so does not really matter)
mutate(
Value = gsub("€", "", Value),
Value = case_when(
grepl("M", Value) ~ as.numeric(gsub("M", "", Value)) * 1e6,
grepl("K", Value) ~ as.numeric(gsub("K", "", Value)) * 1e3,
TRUE ~ as.numeric(Value)
),
Height = as.numeric(gsub("cm", "", Height)),
Weight = as.numeric(gsub("kg", "", Weight))
) %>%
filter(is.finite(Value), Value > 0) %>%
na.omit()
summary(fifa_clean$Value)
var(fifa_clean$Value)
mod_initial <- lm(Value ~ ., fifa_clean)
summary(mod_initial)
plot(mod_initial,1)
plot(mod_initial,2)
library(MASS)
bc <- boxcox(mod_initial)
lambda <- bc$x[which.max(bc$y)]
lambda
# log transformation
fifa_clean <- fifa_clean %>%
mutate(Value_bc = log(Value))
mod_bc <- lm(Value_bc ~ ., data = fifa_clean %>% dplyr::select(-Value))
# Diagnostic plots
plot(mod_bc, 1)
plot(mod_bc, 2)
summary(mod_bc)
diff_norm_log <- summary(mod_bc)$adj.r.squared - summary(mod_initial)$adj.r.squared
diff_norm_log * 100
library(car)
vif(mod_bc)
step_mod <- step(mod_bc, method = 'both', trace = 0)
summary(step_mod)
vif(step_mod)
confint(step_mod)
ggplot(fifa_clean, aes(x = Value)) +
geom_histogram(bins = 50, fill = "steelblue") +
scale_x_continuous(labels = scales::comma) +
labs(title = "Distribution of Player Market Value (Raw)",
x = "Market Value (€)", y = "Count")
ggplot(fifa_clean, aes(x = Value_bc)) +
geom_histogram(bins = 50, fill = "darkgreen") +
labs(title = "Distribution of Log Market Value",
x = "log(Value)", y = "Count")
library(tidyverse)
fifa <- read.csv('FIFA22_official_data.csv')
head(fifa)
names(fifa)
# CLEAN DATA
fifa_clean <- fifa %>%
dplyr::select(Value, Age, Overall, Preferred.Foot, Skill.Moves, Height, Weight,
Crossing, Finishing, HeadingAccuracy, ShortPassing, Volleys,
Dribbling, Curve, FKAccuracy, LongPassing, BallControl,
Acceleration, SprintSpeed, Agility, Reactions, Balance,
ShotPower, Jumping, Stamina, Strength, LongShots, Aggression,
Interceptions, Positioning, Vision, Penalties, Composure,
StandingTackle, SlidingTackle, DefensiveAwareness) %>%
# converting value strings to numerics and removing unit symbols (note: still in euros... virtual money so does not really matter)
mutate(
Value = gsub("€", "", Value),
Value = case_when(
grepl("M", Value) ~ as.numeric(gsub("M", "", Value)) * 1e6,
grepl("K", Value) ~ as.numeric(gsub("K", "", Value)) * 1e3,
TRUE ~ as.numeric(Value)
),
Height = as.numeric(gsub("cm", "", Height)),
Weight = as.numeric(gsub("kg", "", Weight))
) %>%
filter(is.finite(Value), Value > 0) %>%
na.omit()
summary(fifa_clean$Value)
var(fifa_clean$Value)
mod_initial <- lm(Value ~ ., fifa_clean)
summary(mod_initial)
plot(mod_initial,1)
plot(mod_initial,2)
library(MASS)
bc <- boxcox(mod_initial)
lambda <- bc$x[which.max(bc$y)]
lambda
# log transformation
fifa_clean <- fifa_clean %>%
mutate(Value_bc = log(Value))
mod_bc <- lm(Value_bc ~ ., data = fifa_clean %>% dplyr::select(-Value))
# Diagnostic plots
plot(mod_bc, 1)
plot(mod_bc, 2)
summary(mod_bc)
diff_norm_log <- summary(mod_bc)$adj.r.squared - summary(mod_initial)$adj.r.squared
diff_norm_log * 100
library(car)
vif(mod_bc)
step_mod <- step(mod_bc, method = 'both', trace = 0)
summary(step_mod)
vif(step_mod)
confint(step_mod)
ggplot(fifa_clean, aes(x = Value)) +
geom_histogram(bins = 50, fill = "steelblue") +
scale_x_continuous(labels = scales::comma) +
labs(title = "Distribution of Player Market Value (Raw)",
x = "Market Value (€)", y = "Count")
ggplot(fifa_clean, aes(x = Value_bc)) +
geom_histogram(bins = 50, fill = "darkgreen") +
labs(title = "Distribution of Log Market Value",
x = "log(Value)", y = "Count")
library(car)
vif(mod_bc)
