# bloodpressure [- 2] removes the second row and keeps all columns
mod_2 <- lm(SBP ~ Age, bloodpressure[-2,])
summary(mod)
summary(mod_2)
plot(SBP ~ Age, bloodpressure)
abline(mod)
abline(mod_2, lty=2)
# bloodpressure [- 2] removes the second row and keeps all columns
mod_2 <- lm(SBP ~ Age, bloodpressure[-2,])
summary(mod)
summary(mod_2)
plot(SBP ~ Age, bloodpressure)
abline(mod)
abline(mod_2, lty=2)
# bloodpressure [- 2] removes the second row and keeps all columns
mod_2 <- lm(SBP ~ Age, bloodpressure[-2,])
summary(mod)
summary(mod_2)
plot(SBP ~ Age, bloodpressure)
abline(mod)
abline(mod_2, lty=2)
#lets look at a studentized residual plot
plot(fitted(mod_2), rstudent(mod_2))
for i in range 1:5{
for i in range 1:5{
for range 1:5{
for i in range 1:5{
for i in range(5){
for range(5){
for (i in range(1:5)){
i
}
for (i in range(1:5)){
print(i)
}
for (i in range(1,5)){
print(i)
}
for (i in range(5)){
print(i)
}
for (i in range(1,5)){
print(i)
}
for (i in range(1,5)){
print(i)
}
for (i in range(1-5)){
print(i)
}
for (i in range(5)){
print(i)
}
for (i in (1:5)){
print(i)
}
#
plot(mod,4)
func <- function readme(x){
# plot(mod,4) plots each point by its cooks distance
plot(mod,4)
# lets compare the cooks distane for observation 2 to the 4/(n-k-1) cutoff
cooks.distance(mod)[2]
# plot(mod,4) plots each point by its cooks distance
plot(mod,4)
# lets compare the cooks distane for observation 2 to the 4/(n-k-1) cutoff
cooks.distance(mod)[2]/(n-k-1)
# plot(mod,4) plots each point by its cooks distance
plot(mod,4)
# lets compare the cooks distane for observation 2 to the 4/(n-k-1) cutoff
cooks.distance(mod)[-2,]/(n-k-1)
# plot(mod,4) plots each point by its cooks distance
plot(mod,4)
# lets compare the cooks distane for observation 2 to the 4/(n-k-1) cutoff
cooks.distance(mod)[-2]/(n-k-1)
# plot(mod,4) plots each point by its cooks distance
plot(mod,4)
# lets compare the cooks distane for observation 2 to the 4/(n-k-1) cutoff
cooks.distance(mod)[2]/(n-k-1)
# plot(mod,4) plots each point by its cooks distance
plot(mod,4)
# lets compare the cooks distane for observation 2 to the 4/(n-k-1) cutoff
cooks.distance(mod)[2] > 4/(n-k-1)
# Need library(regclass) to run the VIF function
library(regclass)
# Need library(regclass) to run the VIF function
library(regclass)
# Need library(regclass) to run the VIF function
import library(regclass)
# Need library(regclass) to run the VIF function
install.packages(regclass)
# Need library(regclass) to run the VIF function
install.packages("regclass")
# Need library(regclass) to run the VIF function
library(regclass)
health <- read.csv("Data/insurance.csv")
mod <- lm(charges ~ ., health)
VIF(mod)
ssm1 <- 2469.18
ssm2 <- 3647.83
ssm3 <- 4348.22
#find additional ss
ss_x2_given_x1 <- ssm2 - ssm1
ss_x3_given_x1x2 <- ssm3 - ssm2
ss_x2_given_x1
ss_x3_given_x1x2
total_additional_ssm <- ss_x2_given_x1 + ss_x3_given_x1x2
ssm1 <- 2469.18
ssm2 <- 3647.83
ssm3 <- 4348.22
#find additional ss
ss_x2_given_x1 <- ssm2 - ssm1
ss_x3_given_x1x2 <- ssm3 - ssm2
ss_x2_given_x1
ss_x3_given_x1x2
total_additional_ssm <- ss_x2_given_x1 + ss_x3_given_x1x2
total_additional_ssm
health <- read.csv("Data\insurance.csv")
health <- read_csv("Data\insurance.csv")
health <- read_csv("Data/insurance.csv")
health <- read.csv("Data/insurance.csv")
health <- read.csv("Data/insurance.csv")
view(health)
health <- read.csv("Data/insurance.csv")
view(insurance)
library(readr)
insurance <- read_csv("Confounding and Interactions/Data/insurance.csv")
View(insurance)
health <- read.csv("Data/insurance.csv")
view(insurance)
health <- read.csv("Data/insurance.csv")
mod <- lm(charges ~ bmi, smoker, health)
health <- read.csv("Data/insurance.csv")
mod <- lm(charges ~ bmi, smokeryes, health)
health <- read.csv("Data/insurance.csv")
mod <- lm(charges ~ bmi + smoker, health)
health <- read.csv("Data/insurance.csv")
mod <- lm(charges ~ bmi, health)
mod <- lm(charges ~ bmi + smoker, health)
health <- read.csv("Data/insurance.csv")
mod <- lm(charges ~ bmi, health)
mod2 <- lm(charges ~ bmi + smoker, health)
r2_mod <- summary(mod)r.squared
health <- read.csv("Data/insurance.csv")
mod <- lm(charges ~ bmi, health)
mod2 <- lm(charges ~ bmi + smoker, health)
r2_mod <- summary(mod)$r.squared
r2_mod2 <- summary(mod)$r.squared
r2_mo2 - r2_mod
health <- read.csv("Data/insurance.csv")
mod <- lm(charges ~ bmi, health)
mod2 <- lm(charges ~ bmi + smoker, health)
r2_mod <- summary(mod)$r.squared
r2_mod2 <- summary(mod2)$r.squared
r2_mod2 - r2_mod
health <- read.csv("Data/insurance.csv")
mod <- lm(charges ~ bmi, health)
mod2 <- lm(charges ~ bmi + smoker, health)
r2_mod <- summary(mod)$r.squared
r2_mod2 <- summary(mod2)$r.squared
r2_mod2 - r2_mod
health <- read.csv("Data/insurance.csv")
mod <- lm(charges ~ bmi, health)
mod2 <- lm(charges ~ bmi + smoker, health)
r2_mod <- summary(mod)$r.squared
r2_mod2 <- summary(mod2)$r.squared
r2_mod2 - r2_mod
r2_mod
r2_mod2
health <- read.csv("Data/insurance.csv")
mod <- lm(charges ~ bmi, health)
mod2 <- lm(charges ~ bmi + smoker, health)
anova(mod,mod2)
library(lmtest)
bptest(mod2)
ks.test(rstandard(mod_2), "pnorm")
library(lmtest)
bptest(mod2)
ks.test(rstandard(mod_2), "pnorm")
library(lmtest)
bptest(mod2)
ks.test(rstandard(mod2), "pnorm")
library(lmtest)
bptest(mod2)
ks.test(rstandard(mod2), "pnorm")
library(lmtest)
bptest(mod2)
plot(mod2,1)
ks.test(rstandard(mod2), "pnorm")
plot(mod2,2)
library(tidyverse)
health <- read.csv("Data/insurance.csv")
mod <- lm(charges ~ smoker + bmi,health)
mod2 <-  lm(charges ~ smoker * bmi,health)
health %>%
mutate(pred_charges = mod$fitted.values,
pred_charges2 = mod2$fitted.values) %>%
ggplot(aes(x=bmi,y=charges,colour=smoker)) +
geom_point(size=0.5) +
geom_line(aes(y=pred_charges),lty=2) +
geom_line(aes(y=pred_charges2))
mod_confound <- lm(bmi ~ smoker, health)
summary(mod_confound)
# X1:X2 adds an interaction term between X1 and X2
mod_int <- lm(charges~bmi+smoker+bmi:smoker,health)
# X1*X2 this adds the effects of X1 and X2 and an interaction term between X1 and X2
mod_int <- lm(charges ~ bmi*smoker, health)
coef(mod_int)
# --- Load data ---
X1 <- readRDS("Data/X1.rds")
X2 <- readRDS("Data/X2.rds")
y  <- readRDS("Data/y.rds")
# Ensure matrix
X1 <- as.matrix(X1)
X2 <- as.matrix(X2)
y  <- as.matrix(y)
# --- Dimensions ---
n  <- nrow(X1)
p1 <- ncol(X1)
# --- Projection matrix, fitted, residuals ---
XtX_1    <- t(X1) %*% X1               # p1 x p1
XtX_1inv <- solve(XtX_1)               # p1 x p1
P1       <- X1 %*% XtX_1inv %*% t(X1)  # n x n
yhat1 <- P1 %*% y                      # n x 1
resid1 <- y - yhat1                    # n x 1
# --- Sums of squares ---
SST  <- (t(y) %*% y)
SSR1 <- (t(yhat1) %*% yhat1)
SSE1 <- (t(resid1) %*% resid1)
# --- sigma^2 (scalar!) ---
sigma2_hat_1 <- SSE1 / (n - p1)
# --- beta_hat and Var(beta_hat) ---
beta_hat_1 <- XtX_1inv %*% (t(X1) %*% y)   # p1 x 1
Var_beta_1 <- as.numeric(sigma2_hat_1) * XtX_1inv   # scalar * matrix (use * not %*%)
# --- t-test for slope (assumes col 1 = intercept, col 2 = X1) ---
t_stat <- (beta_hat_1[2,1] / sqrt(Var_beta_1[2,2]))
df     <- n - p1
p_val  <- 2 * (1 - pt(abs(t_stat), df))
t_stat
p_val
git pull main/Homework4
git pull
# Load data
X1 <- readRDS("Data/X1.rds")
X2 <- readRDS("Data/X2.rds")
y  <- readRDS("Data/y.rds")
# Ensure matrix
X1 <- as.matrix(X1)
X2 <- as.matrix(X2)
y  <- as.matrix(y)
# Dimensions
n1  <- nrow(X1)
p1 <- ncol(X1)
# Projection matrix, fitted, residuals
XtX_1    <- t(X1) %*% X1
XtX_1inv <- solve(XtX_1)
P1       <- X1 %*% XtX_1inv %*% t(X1)
yhat1 <- P1 %*% y
resid1 <- y - yhat1
# Sums of squares errors
SSE1 <- (t(resid1) %*% resid1)
# sigma^2
sigma2_hat_1 <- SSE1 / (n1 - p1)
# beta_hat and Var(beta_hat)
beta_hat_1 <- XtX_1inv %*% (t(X1) %*% y)
Var_beta_1 <- as.numeric(sigma2_hat_1) * XtX_1inv
# t-test for slope (assumes col 1 = intercept, col 2 = X1)
t_stat <- (beta_hat_1[2,1] / sqrt(Var_beta_1[2,2]))
df     <- n1 - p1
p_val  <- 2 * (1 - pt(abs(t_stat), df))
t_stat
p_val
X1 <- readRDS("Data/X1.rds")
X2 <- readRDS("Data/X2.rds")
y  <- readRDS("Data/y.rds")
X1 <- as.matrix(X1)
X2 <- as.matrix(X2)
y  <- as.matrix(y)
n1  <- nrow(X1)
p1 <- ncol(X1)
XtX_1    <- t(X1) %*% X1
XtX_1inv <- solve(XtX_1)
P1       <- X1 %*% XtX_1inv %*% t(X1)
yhat1 <- P1 %*% y
resid1 <- y - yhat1
SSE1 <- (t(resid1) %*% resid1)
sigma2_hat_1 <- SSE1 / (n1 - p1)
beta_hat_1 <- XtX_1inv %*% (t(X1) %*% y)
Var_beta_1 <- as.numeric(sigma2_hat_1) * XtX_1inv
t_stat <- (beta_hat_1[2,1] / sqrt(Var_beta_1[2,2]))
df     <- n1 - p1
p_val  <- 2 * (1 - pt(abs(t_stat), df))
t_stat
p_val
BX2 <- solve(t(X2) %*% X2) %*% t(X2) %*% y
ybar <- mean(y)
SSEX2 <- t(y - X2 %*% BX2) %*% (y - X2 %*% BX2)
SSTX2 <- sum((y - ybar)^2)
SSMX2 <- SSTX2 - SSEX2
R2X2 <- SSMX2 / SSTX2
R2X2
n  <- nrow(X1)
pR <- ncol(X1)
pF <- ncol(X2)
q  <- pF - pR
I  <- diag(n)
PR <- X1 %*% solve(t(X1) %*% X1) %*% t(X1)
PF <- X2 %*% solve(t(X2) %*% X2) %*% t(X2)
SSE_R <- as.numeric(t(y) %*% (I - PR) %*% y)
SSE_F <- as.numeric(t(y) %*% (I - PF) %*% y)
num <- (SSE_R - SSE_F) / q
den <- SSE_F / (n - pF)
f   <- num / den
p <- 1 - pf(f, q, n - pF)
f
p
#check to make sure
modred <- lm(y ~ X1)
modfull <- lm(y ~ X2)
anova(modred, modfull)
# yup we good
n  <- nrow(X1)
pR <- ncol(X1)
pF <- ncol(X2)
q  <- pF - pR
I  <- diag(n)
PR <- X1 %*% solve(t(X1) %*% X1) %*% t(X1)
PF <- X2 %*% solve(t(X2) %*% X2) %*% t(X2)
SSE_R <- as.numeric(t(y) %*% (I - PR) %*% y)
SSE_F <- as.numeric(t(y) %*% (I - PF) %*% y)
num <- (SSE_R - SSE_F) / q
den <- SSE_F / (n - pF)
f   <- num / den
p <- 1 - pf(f, q, n - pF)
f
p
#check to make sure
modred <- lm(y ~ X1)
modfull <- lm(y ~ X2)
anova(modred, modfull)
# yup we good
# From class convo it is clear you wanted linear but I did rstud() method first
# initial observation
plot(modfull,1) #modfull is y ~ XZ (above)
# obs 11 is an influential observation, 73
rstud <- rstudent(modfull)
id1 <- which.max(abs(rstud))
n <- nrow(X2)
k <- 4
alpha <- 0.01
crit <- qt(1-alpha/2,n-k-1)
(abs(rstud)[id1] > crit)
# observation 73 is our next influential observation
modfull2 <- lm(y[-11,] ~ X2[-11, -1])
rstud2 <- rstudent(modfull2)
id2 <- which.max(abs(rstud2))
abs(rstud2)[id2] > crit
# next one 42 is not an influential observation
infl_obs <- c(11,73)
modfull3 <- lm(y[-infl_obs,] ~ X2[-infl_obs, -1])
rstud3 <- rstudent(modfull3)
id3 <- which.max(abs(rstud3))
abs(rstud3)[id3] > crit
# LINEAR
# first test, 11 is influential
hat_mat <- X2 %*% solve(t(X2) %*% X2) %*% t(X2)
yhatx2 <- X2 %*% BX2
errorest <- y - yhatx2
lev <- diag(hat_mat)
MSEX2 <- SSEX2 / (nrow(X2) - k)
stud_resid <- errorest / sqrt(as.numeric(MSEX2)) * sqrt(1 - lev)
id4 <- which.max(abs(stud_resid))
id4
abs(stud_resid)[id4] > crit
# 11 is true
#second test, 73 is influential
X2_rm11 <- X2[-11,]
hat_mat <- X2_rm11 %*% solve(t(X2_rm11) %*% X2_rm11) %*% t(X2_rm11)
yhatx2 <- X2_rm11 %*% BX2
errorest <- y[-11,] - yhatx2
lev <- diag(hat_mat)
MSEX2 <- SSEX2 / (nrow(X2_rm11) - k)
stud_resid <- errorest / sqrt(as.numeric(MSEX2)) * sqrt(1 - lev)
id5 <- which.max(abs(stud_resid))
id5
abs(stud_resid)[id5] > crit
#third test
inf <- c(11,73)
X2_rm_inf <- X2[-inf,]
hat_mat <- X2_rm_inf %*% solve(t(X2_rm_inf) %*% X2_rm_inf) %*% t(X2_rm_inf)
yhatx2 <- X2_rm_inf %*% BX2
errorest <- y[-inf] - yhatx2
lev <- diag(hat_mat)
MSEX2 <- SSEX2 / (nrow(X2_rm_inf) - k)
stud_resid <- errorest / sqrt(as.numeric(MSEX2)) * sqrt(1 - lev)
id6 <- which.max(abs(stud_resid))
id6
abs(stud_resid)[id6] > crit
# From class convo it is clear you wanted linear but I did rstud() method first
# initial observation
plot(modfull,1) #modfull is y ~ XZ (above)
# obs 11 is an influential observation, 73
rstud <- rstudent(modfull)
id1 <- which.max(abs(rstud))
n <- nrow(X2)
k <- 4
alpha <- 0.01
crit <- qt(1-alpha/2,n-k-1)
(abs(rstud)[id1] > crit)
# observation 73 is our next influential observation
modfull2 <- lm(y[-11,] ~ X2[-11, -1])
rstud2 <- rstudent(modfull2)
id2 <- which.max(abs(rstud2))
abs(rstud2)[id2] > crit
# next one 42 is not an influential observation
infl_obs <- c(11,73)
modfull3 <- lm(y[-infl_obs,] ~ X2[-infl_obs, -1])
rstud3 <- rstudent(modfull3)
id3 <- which.max(abs(rstud3))
abs(rstud3)[id3] > crit
# LINEAR
# first test, 11 is influential
hat_mat <- X2 %*% solve(t(X2) %*% X2) %*% t(X2)
yhatx2 <- X2 %*% BX2
errorest <- y - yhatx2
lev <- diag(hat_mat)
MSEX2 <- SSEX2 / (nrow(X2) - k)
stud_resid <- errorest / sqrt(as.numeric(MSEX2)) * sqrt(1 - lev)
id4 <- which.max(abs(stud_resid))
id4
abs(stud_resid)[id4] > crit
# 11 is true
#second test, 73 is influential
X2_rm11 <- X2[-11,]
hat_mat <- X2_rm11 %*% solve(t(X2_rm11) %*% X2_rm11) %*% t(X2_rm11)
yhatx2 <- X2_rm11 %*% BX2
errorest <- y[-11,] - yhatx2
lev <- diag(hat_mat)
MSEX2 <- SSEX2 / (nrow(X2_rm11) - k)
stud_resid <- errorest / sqrt(as.numeric(MSEX2)) * sqrt(1 - lev)
id5 <- which.max(abs(stud_resid))
id5
abs(stud_resid)[id5] > crit
#third test
inf <- c(11,73)
X2_rm_inf <- X2[-inf,]
hat_mat <- X2_rm_inf %*% solve(t(X2_rm_inf) %*% X2_rm_inf) %*% t(X2_rm_inf)
yhatx2 <- X2_rm_inf %*% BX2
errorest <- y[-inf] - yhatx2
lev <- diag(hat_mat)
MSEX2 <- SSEX2 / (nrow(X2_rm_inf) - k)
stud_resid <- errorest / sqrt(as.numeric(MSEX2)) * sqrt(1 - lev)
id6 <- which.max(abs(stud_resid))
id6
abs(stud_resid)[id6] > crit
# From class convo it is clear you wanted linear but I did rstud() method first
# initial observation
plot(modfull,1) #modfull is y ~ XZ (above)
# obs 11 is an influential observation, 73
rstud <- rstudent(modfull)
id1 <- which.max(abs(rstud))
n <- nrow(X2)
k <- 4
alpha <- 0.01
crit <- qt(1-alpha/2,n-k-1)
(abs(rstud)[id1] > crit)
# observation 73 is our next influential observation
modfull2 <- lm(y[-11,] ~ X2[-11, -1])
rstud2 <- rstudent(modfull2)
id2 <- which.max(abs(rstud2))
abs(rstud2)[id2] > crit
# next one 42 is not an influential observation
infl_obs <- c(11,73)
modfull3 <- lm(y[-infl_obs,] ~ X2[-infl_obs, -1])
rstud3 <- rstudent(modfull3)
id3 <- which.max(abs(rstud3))
abs(rstud3)[id3] > crit
# LINEAR
# first test, 11 is influential
hat_mat <- X2 %*% solve(t(X2) %*% X2) %*% t(X2)
yhatx2 <- X2 %*% BX2
errorest <- y - yhatx2
lev <- diag(hat_mat)
MSEX2 <- SSEX2 / (nrow(X2) - k)
stud_resid <- errorest / sqrt(as.numeric(MSEX2)) * sqrt(1 - lev)
id4 <- which.max(abs(stud_resid))
id4
abs(stud_resid)[id4] > crit
# 11 is true
#second test, 73 is influential
X2_rm11 <- X2[-11,]
hat_mat <- X2_rm11 %*% solve(t(X2_rm11) %*% X2_rm11) %*% t(X2_rm11)
yhatx2 <- X2_rm11 %*% BX2
errorest <- y[-11,] - yhatx2
lev <- diag(hat_mat)
MSEX2 <- SSEX2 / (nrow(X2_rm11) - k)
stud_resid <- errorest / sqrt(as.numeric(MSEX2)) * sqrt(1 - lev)
id5 <- which.max(abs(stud_resid))
id5
abs(stud_resid)[id5] > crit
#third test
inf <- c(11,73)
X2_rm_inf <- X2[-inf,]
hat_mat <- X2_rm_inf %*% solve(t(X2_rm_inf) %*% X2_rm_inf) %*% t(X2_rm_inf)
yhatx2 <- X2_rm_inf %*% BX2
errorest <- y[-inf] - yhatx2
lev <- diag(hat_mat)
MSEX2 <- SSEX2 / (nrow(X2_rm_inf) - k)
stud_resid <- errorest / sqrt(as.numeric(MSEX2)) * sqrt(1 - lev)
id6 <- which.max(abs(stud_resid))
id6
abs(stud_resid)[id6] > crit
