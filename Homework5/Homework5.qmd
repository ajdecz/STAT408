---
title: "Homework 5 - AD"
format: 
  html:
    self-contained: true
    embed-resources: true
editor: visual
execute: 
  echo: true
  include: true
---

Consider the lifexp dataset in the exam project which contains information on countries from the year 2015. The variables contained in the dataset are defined as follows:

-   {Status}: Development status of the country

-   {Life.Expectancy}: Country's average life expectancy in years

-   {Adult.Mortality}: Number of deaths of people between 15 and 60 per 1000 population

-   {infant.deaths}: Number of infant deaths per 1000 population

-   {Measles}: Number of measles cases per 1000 population

-   {BMI}: average BMI for entire population

-   {under.five.deaths}: Number of Under five deaths per 1000 population

-   {Polio}: Polio immunization coverage for 1 year olds

-   {Diptheria}: Diphtheria tetanus toxoid and pertussis immunization coverage for 1 year olds

-   {HIV.AIDS}: Deaths per 1000 live births from HIV/AIDS (0-4 year olds)

-   {Income.composition.of.resources}: Human Development Index in terms of income composition of resources (from 0 to 1)

-   {Schooling}: Number of Years of Schooling

We are interested in creating a regression model that predicts a country's life expectancy based on the other factors in the dataset. More specifically, we would like to determine the "best" overall prediction model for life expectancy using all of the other variables in our dataset as predictors.

-   

    a.  Should we include any interaction or polynomial terms in our maximum model? Explain your reasoning.

        Yes we should include both polynomial and interaction terms in our maximum model. Scatterplots showed clear curvature for variables like infant.deaths, under.five.deaths, Polio, Diphtheria, and HIV.AIDS, so squared terms were added to capture these nonlinear relationships. Several interactions, especially those involving status and socioeconomic factors like Income.composition.of.resources and Schooling, also appeared to have different effects and proved to be statistically significant using the both ways step function using AIC as criterion for inclusion in the model.

```{r}
library(tidyverse)
health <- read.csv("Data/lifeexp.csv")

# Scatterplots to see if we need to include a polynomial term

# Adult.Mortality - Linear
ggplot(health, aes(x = Adult.Mortality, y = Life.expectancy)) +
  geom_point()
  
# infant.deaths - Polynomial 
ggplot(health, aes(x = infant.deaths, y = Life.expectancy)) +
  geom_point()+
  xlim(0,75)

# Measles - no relationship
ggplot(health, aes(x = Measles, y = Life.expectancy)) +
  geom_point()

# BMI - Linear
ggplot(health, aes(x = BMI, y = Life.expectancy)) +
  geom_point()

# under.five.deaths - Polynomial
ggplot(health, aes(x = under.five.deaths, y = Life.expectancy)) +
  geom_point()+
  xlim(0,100)

# Polio - Polynomial
ggplot(health, aes(x = Polio, y = Life.expectancy)) +
  geom_point()

# Diphtheria - Polynomial
ggplot(health, aes(x = Diphtheria, y = Life.expectancy)) +
  geom_point()

# HIV.AIDS - Polynomial
ggplot(health, aes(x = HIV.AIDS, y = Life.expectancy)) +
  geom_point()

# Income.composition.of.resources - Linear
ggplot(health, aes(x = Income.composition.of.resources, y = Life.expectancy)) +
  geom_point()

# Schooling - Linear
ggplot(health, aes(x = Schooling, y = Life.expectancy)) +
  geom_point()

mod_max <- lm(Life.expectancy ~ .*. + I(infant.deaths^2) + I(under.five.deaths^2) + I(Polio^2) +I(Diphtheria^2) + I(HIV.AIDS^2), health)

mod_best <- step(mod_max, direction = "both", trace = 0)
summary(mod_best)

```

-   

    b.  Using the maximum model you used in (a) backward selection with Mallow's $C_p$ as your decision criteria to eliminate variables from your model.

```{r}
library(leaps)

var_sel <- regsubsets(Life.expectancy ~ .*. + I(infant.deaths^2) + I(under.five.deaths^2) + I(Polio^2) +I(Diphtheria^2) + I(HIV.AIDS^2), health, method='backward', nvmax = 100, really.big = TRUE)

which.min(summary(var_sel)$cp) 
coef(var_sel,32)
```

-   

    c.  Write your final regression model for predicting life expectancy.

```{r}
final_model <- lm(
  Life.expectancy ~ 
    Status +
    BMI +
    Diphtheria +
    I(infant.deaths^2) +
    I(under.five.deaths^2) +
    I(Polio^2) +
    I(Diphtheria^2) +
    I(HIV.AIDS^2) +
    Status:Measles +
    Status:Diphtheria +
    Status:HIV.AIDS +
    Adult.Mortality:BMI +
    Adult.Mortality:under.five.deaths +
    Adult.Mortality:Diphtheria +
    Adult.Mortality:Schooling +
    infant.deaths:BMI +
    infant.deaths:Polio +
    infant.deaths:Diphtheria +
    infant.deaths:HIV.AIDS +
    Measles:BMI +
    Measles:under.five.deaths +
    Measles:Polio +
    Measles:HIV.AIDS +
    BMI:Diphtheria +
    BMI:HIV.AIDS +
    BMI:Schooling +
    under.five.deaths:Diphtheria +
    under.five.deaths:HIV.AIDS +
    Polio:Diphtheria +
    Polio:Income.composition.of.resources +
    Diphtheria:HIV.AIDS +
    HIV.AIDS:Schooling,
    health
)


```

-   

    d.  Determine if the assumptions of homoscedasticity and normally distributed residuals is violated. If one is violated, suggest a transformation of the response variable.

        None of the assumptions are violated, therefore no transformations of the response variable would be needed.

```{r}
library(lmtest)
plot(final_model,1)
bptest(final_model)

plot(final_model,2)
ks.test(rstandard(final_model),"pnorm")
```
